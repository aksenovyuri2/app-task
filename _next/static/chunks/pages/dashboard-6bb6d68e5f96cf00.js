(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[26],{6117:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard",function(){return t(1832)}])},1832:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return Dashboard}});var a=t(5893),n=t(7294),i=t(3299),l=t(5263);function FilterPanel(e){let{metrics:s,selectedMetrics:t,setSelectedMetrics:n,dateRange:i,setDateRange:r}=e,handleMetricToggle=e=>{n(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])};return(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Фильтры"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium mb-2",children:"Метрики"}),(0,a.jsx)("div",{className:"space-y-2",children:s.map(e=>(0,a.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,a.jsx)("input",{type:"checkbox",checked:t.includes(e.id),onChange:()=>handleMetricToggle(e.id),className:"rounded border-gray-300"}),(0,a.jsx)("span",{children:e.name})]},e.id))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium mb-2",children:"Период"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-gray-600",children:"Начало"}),(0,a.jsx)("input",{type:"date",value:(0,l.ZP)(i.start,"yyyy-MM-dd"),onChange:e=>r({...i,start:new Date(e.target.value)}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-gray-600",children:"Конец"}),(0,a.jsx)("input",{type:"date",value:(0,l.ZP)(i.end,"yyyy-MM-dd"),onChange:e=>r({...i,end:new Date(e.target.value)}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm"})]})]})]})]})]})}var r=t(6495),c=t(3148);function MetricsChart(e){let{metrics:s,selectedMetrics:t,dateRange:n}=e,i=s.filter(e=>t.includes(e.type)&&new Date(e.timestamp)>=n.start&&new Date(e.timestamp)<=n.end),l=i.reduce((e,s)=>(e[s.type]||(e[s.type]=[]),e[s.type].push({value:s.value,timestamp:new Date(s.timestamp)}),e),{}),c={labels:i.map(e=>new Date(e.timestamp).toLocaleDateString()).filter((e,s,t)=>t.indexOf(e)===s),datasets:Object.entries(l).map(e=>{let[s,t]=e;return{label:s.toUpperCase(),data:t.map(e=>e.value),borderColor:"dau"===s?"rgb(75, 192, 192)":"rgb(255, 99, 132)",tension:.1}})};return(0,a.jsx)(r.x1,{options:{responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"Metrics Overview"}},scales:{y:{beginAtZero:!0}}},data:c})}function RecommendationsPanel(e){let{recommendations:s}=e;return s.length?(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Recommendations"}),(0,a.jsx)("ul",{className:"space-y-2",children:s.map((e,s)=>(0,a.jsxs)("li",{className:"flex items-start",children:[(0,a.jsx)("span",{className:"text-blue-500 mr-2",children:"•"}),(0,a.jsx)("span",{children:e})]},s))})]}):null}c.kL.register(c.uw,c.f$,c.od,c.jn,c.Dx,c.u,c.De);let d=[{id:"dau",name:"DAU"},{id:"retention",name:"Retention"}];function Dashboard(){let{data:e}=(0,i.useSession)(),[s,t]=(0,n.useState)([]),[l,r]=(0,n.useState)({start:new Date(Date.now()-6048e5),end:new Date}),[c,o]=(0,n.useState)([]),[m,h]=(0,n.useState)([]);(0,n.useEffect)(()=>{e&&(fetchMetrics(),fetchRecommendations())},[e,s,l]);let fetchMetrics=async()=>{try{let e=await fetch("/api/metrics",{method:"GET",headers:{"Content-Type":"application/json"}}),s=await e.json();o(s)}catch(e){console.error("Error fetching metrics:",e)}},fetchRecommendations=async()=>{try{let e=await fetch("/api/metrics/recommendations"),s=await e.json();h(s.recommendations)}catch(e){console.error("Error fetching recommendations:",e)}};return e?(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-8",children:"Analytics Dashboard"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8",children:[(0,a.jsx)("div",{className:"lg:col-span-1",children:(0,a.jsx)(FilterPanel,{metrics:d,selectedMetrics:s,setSelectedMetrics:t,dateRange:l,setDateRange:r})}),(0,a.jsxs)("div",{className:"lg:col-span-3",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 mb-8",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Metrics Overview"}),(0,a.jsx)(MetricsChart,{metrics:c,selectedMetrics:s,dateRange:l})]}),(0,a.jsx)(RecommendationsPanel,{recommendations:m})]})]})]}):(0,a.jsx)("div",{children:"Please sign in to view the dashboard."})}}},function(e){e.O(0,[196,368,774,888,179],function(){return e(e.s=6117)}),_N_E=e.O()}]);