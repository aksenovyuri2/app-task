(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[933],{1887:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/tests/[id]",function(){return s(4675)}])},4675:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return TestPage}});var a=s(5893),n=s(1163),i=s(7294),l=s(3299);function Test(e){let{testId:t,name:s,description:n,timeLimit:r,questions:c,onComplete:d}=e,{data:o}=(0,l.useSession)(),[x,h]=(0,i.useState)(0),[m,u]=(0,i.useState)({}),[g,p]=(0,i.useState)(60*r),[j,b]=(0,i.useState)(!1);(0,i.useEffect)(()=>{if(g>0&&!j){let e=setInterval(()=>{p(t=>t<=1?(clearInterval(e),handleSubmit(),0):t-1)},1e3);return()=>clearInterval(e)}},[g,j]);let handleAnswer=(e,t)=>{u(s=>({...s,[e]:t}))},handleSubmit=async()=>{b(!0);try{let e=await fetch("/api/tests/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({testId:t,answers:m,timeSpent:60*r-g})});if(!e.ok)throw Error("Ошибка при отправке результатов");let s=await e.json();d(s)}catch(e){console.error("Ошибка:",e)}};return(0,a.jsx)("div",{className:"max-w-4xl mx-auto p-6",children:(0,a.jsxs)("div",{className:"bg-gray-900 rounded-lg shadow-xl p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-white mb-2",children:s}),(0,a.jsx)("p",{className:"text-gray-400",children:n})]}),(0,a.jsx)("div",{className:"text-xl font-mono text-white",children:"".concat(Math.floor(g/60),":").concat((g%60).toString().padStart(2,"0"))})]}),j?(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h3",{className:"text-2xl font-bold text-white mb-4",children:"Тест завершен!"}),(0,a.jsx)("p",{className:"text-gray-400",children:"Результаты будут доступны после проверки."})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsxs)("span",{className:"text-gray-400",children:["Вопрос ",x+1," из ",c.length]}),(0,a.jsxs)("span",{className:"text-gray-400",children:[c[x].points," баллов"]})]}),(0,a.jsx)("h3",{className:"text-xl text-white mb-4",children:c[x].text}),(0,a.jsx)("div",{className:"space-y-3",children:c[x].options.map((e,t)=>(0,a.jsxs)("label",{className:"flex items-center space-x-3 p-3 bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-600 transition-colors",children:[(0,a.jsx)("input",{type:"radio",name:"question-".concat(c[x].id),value:t.toString(),checked:m[c[x].id]===t.toString(),onChange:e=>handleAnswer(c[x].id,e.target.value),className:"form-radio text-indigo-500"}),(0,a.jsx)("span",{className:"text-white",children:e})]},t))})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("button",{onClick:()=>{x>0&&h(e=>e-1)},disabled:0===x,className:"px-4 py-2 bg-gray-700 text-white rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-600 transition-colors",children:"Назад"}),x===c.length-1?(0,a.jsx)("button",{onClick:handleSubmit,className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:"Завершить тест"}):(0,a.jsx)("button",{onClick:()=>{x<c.length-1&&h(e=>e+1)},className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:"Далее"})]})]})]})})}var r=s(6571);function TestResult(e){let{testName:t,score:s,maxScore:n,timeSpent:i,passed:l,answers:c,correctAnswers:d,questions:o}=e;return(0,a.jsx)("div",{className:"max-w-4xl mx-auto p-6",children:(0,a.jsxs)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-gray-900 rounded-lg shadow-xl p-6",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-white mb-2",children:t}),(0,a.jsxs)("div",{className:"flex justify-center items-center space-x-4",children:[(0,a.jsxs)("div",{className:"text-4xl font-bold text-white",children:[Math.round(s/n*100),"%"]}),(0,a.jsxs)("div",{className:"text-gray-400",children:[s," из ",n," баллов"]})]}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)("span",{className:"px-4 py-2 rounded-full text-sm font-medium ".concat(l?"bg-green-500 text-white":"bg-red-500 text-white"),children:l?"Тест пройден":"Тест не пройден"})}),(0,a.jsxs)("div",{className:"mt-2 text-gray-400",children:["Время выполнения: ","".concat(Math.floor(i/60),":").concat((i%60).toString().padStart(2,"0"))]})]}),(0,a.jsx)("div",{className:"space-y-6",children:o.map((e,t)=>{let s=c[e.id],n=d[e.id],i=s===n;return(0,a.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("span",{className:"text-gray-400",children:["Вопрос ",t+1]}),(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-sm ".concat(i?"bg-green-500 text-white":"bg-red-500 text-white"),children:i?"Правильно":"Неверно"})]}),(0,a.jsx)("h3",{className:"text-xl text-white mb-4",children:e.text}),(0,a.jsx)("div",{className:"space-y-3 mb-4",children:e.options.map((e,t)=>{let l=s===t.toString(),r=n===t.toString();return(0,a.jsx)("div",{className:"p-3 rounded-lg ".concat(l?i?"bg-green-500 text-white":"bg-red-500 text-white":r?"bg-green-500 text-white":"bg-gray-700 text-white"),children:e},t)})}),(0,a.jsxs)("div",{className:"mt-4 p-4 bg-gray-700 rounded-lg",children:[(0,a.jsx)("h4",{className:"text-white font-medium mb-2",children:"Объяснение:"}),(0,a.jsx)("p",{className:"text-gray-300",children:e.explanation})]})]},e.id)})})]})})}function TestPage(){let e=(0,n.useRouter)(),{data:t}=(0,l.useSession)(),{id:s}=e.query,[r,c]=(0,i.useState)(null),[d,o]=(0,i.useState)(null),[x,h]=(0,i.useState)(!0);(0,i.useEffect)(()=>{if(!t){e.push("/auth/signin");return}s&&fetchTest()},[s,t]);let fetchTest=async()=>{try{let e=await fetch("/api/tests/".concat(s));if(!e.ok)throw Error("Ошибка при загрузке теста");let t=await e.json();c(t)}catch(e){console.error("Ошибка:",e)}finally{h(!1)}};return x?(0,a.jsx)("div",{className:"min-h-screen bg-black flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-white text-xl",children:"Загрузка..."})}):r?(0,a.jsx)("div",{className:"min-h-screen bg-black py-8",children:d?(0,a.jsx)(TestResult,{testId:r.id,testName:r.name,score:d.score,maxScore:d.maxScore,timeSpent:d.timeSpent,passed:d.passed,answers:d.answers,correctAnswers:r.questions.reduce((e,t)=>({...e,[t.id]:t.correctAnswer}),{}),questions:r.questions}):(0,a.jsx)(Test,{testId:r.id,name:r.name,description:r.description,timeLimit:r.timeLimit,questions:r.questions,onComplete:e=>{o(e)}})}):(0,a.jsx)("div",{className:"min-h-screen bg-black flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-white text-xl",children:"Тест не найден"})})}}},function(e){e.O(0,[700,774,888,179],function(){return e(e.s=1887)}),_N_E=e.O()}]);